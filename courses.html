<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>Examinating - Courses</title>
    <script src="https://raw.githubusercontent.com/mholt/PapaParse/master/papaparse.js"></script>
</head>
<body>
    <div>
        <ul class="site-page-links">
            <li><a  href="index.html" id="MyModules">My Modules</a></li>
            <li><a  href="courses.html" id="All Courses">All Courses</a></li>
            <li><a  href="about.html" id="About">About</a></li>
        </ul>
    </div>
    <div id="options">
        pow
    </div>
    <script>
        
        var MODULE_ID = 0;
        var YEAR_OF_COURSE = 1;
        var MODULE_NAME = 2;
        var LINK = 3;
        var ACADEMIC_YEAR = 4;
        var LAST_ACTIVE_MODULE = 1;
        var MODULES = 2;
        var YEARS = 2016-1998;
        
        window.addEventListener('load',function(){ startUp();},false);
        
        var csvRows;
        
        //Code run once the page is loaded.
        var startUp = function(){
            parseData("https://raw.githubusercontent.com/nating/examinating/master/PastPapers.csv", updateData);
            showAllCourses();
        }
        parseData = function(url, callBack) {
            Papa.parse(url,{download: true, dynamicTyping: true, complete: function(results){ callBack(results.data);} });
        }
        updateData = function(parsedFile) {
            csvRows = parsedFile;
        }
        
        var showAllCourses = function(){
            var options = document.getElementById("options");
            options.innerHTML = `
                <ul class="courses">
                    <li id="AN">Anatomy</li>
                    <li id="AP">Foundation Course for Higher Education</li>
                    <li id="BI">Biochemistry &amp; Immunology</li>
                    <li id="BO">Botany</li>
                    <li id="BU">Business Studies</li>
                    <li id="BY">Biology</li>
                    <li id="CE">Civil Structural &amp; Enviromental Engineering</li>
                    <li id="CH">Chemistry</li>
                    <li id="CL">Classics</li>
                    <li id="CS">Computer Science</li>
                    <li id="DE">Dental Studies</li>
                    <li id="DF">Deaf Studies</li>
                    <li id="DR">Drama</li>
                    <li id="EC">Economics</a></li>
                    <li id="EE">Electrical &amp; Electronic Engineering</li>
                    <li id="EN">English</li>
                    <li id="ES">Enviromental Science</li>
                    <li id="ET">Music Education</li>
                    <li id="FB">Functional Biology</li>
                    <li id="FR">French</li>
                    <li id="GE">Genetics &amp; Microbiology</li>
                    <li id="GG">Geography</li>
                    <li id="GL">Geology</li>
                    <li id="GR">German</li>
                    <li id="HA">History of Art</li>
                    <li id="HE">Religions &amp; Theology</li>
                    <li id="HH">Histories &amp; Humanitaries</li>
                    <li id="HI">History</li>
                    <li id="IE">Imagining Ireland</li>
                    <li id="IR">Irish Studies</li>
                    <li id="IT">Italian</li>
                    <li id="LA">Law</li>
                    <li id="LI">Linguistics</li>
                    <li id="LY">Loyola Institute</li>
                    <li id="MA">Mathematics</li>
                    <li id="MD">Medicine</li>
                    <li id="ME">Mechanical &amp; Manufactural Engineering</li>
                    <li id="MI">Microbiology</li>
                    <li id="MU">Music</li>
                    <li id="MW">Midwifery</a></li>
                    <li id="NM">Near &amp; Middle Eastern Studies</li>
                    <li id="NU">Nursing</a></li>
                    <li id="OT">Occupational Therapy</li>
                    <li id="PG">Physiology</li>
                    <li id="PH">Pharmacy</li>
                    <li id="PI">Phisiology</li>
                    <li id="PL">Polish</li>
                    <li id="PO">Political Science</li>
                    <li id="PR">Psychiatry</li>
                    <li id="PS">Psychology</li>
                    <li id="PT">Physiotherapy</li>
                    <li id="PY">Physics</li>
                    <li id="RT">Radiotherapy</li>
                    <li id="RU">Russian &amp; Slavonic Studies</li>
                    <li id="SL">Clinical Speech &amp; Language Studies</li>
                    <li id="SO">Sociology</li>
                    <li id="SP">Hispanic Studies</li>
                    <li id="SS">Social Work &amp; Social Policy</li>
                    <li id="ST">Statistics</li>
                    <li id="ZO">Zoology</li>
                </ul>`;
            makeCoursesClickable();
        }
        
        var makeCoursesClickable = function() {
            var links = document.getElementsByTagName('li');
            for(var i=0;i<links.length;i++) {
                var link = links[i];
                if(link.parentElement.getAttribute('class') == 'courses') {
                    link.setAttribute("onclick","showYearsOfCourse("+link.getAttribute('id')+");");
                }
            }
        }
        
        var makeYearsClickable = function() {
            var links = document.getElementsByTagName('li');
            for(var i=0;i<links.length;i++) {
                var link = links[i];
                if(link.parentElement.getAttribute('class') == 'years') {
                    console.log(link);
                    link.setAttribute("onclick","showModulesOfYear("+link.getAttribute('id')+");");
                }
            }
        }
        
        var showYearsOfCourse = function(listElement){
            var listOfYears = "<a href=\"courses.html\"><-- All Courses</a><ul class=\"years\">";
            var courseCode = listElement.getAttribute('id');
            var index = getCourseIndex(csvRows,courseCode);
            var currentYear = 0;
            while(csvRows[index][MODULE_ID].indexOf(courseCode)==0){
                if(csvRows[index][ACADEMIC_YEAR] > currentYear){
                    if(csvRows[index][ACADEMIC_YEAR]==1){
                        listOfYears += "<li id=\""+courseCode+csvRows[index][ACADEMIC_YEAR]+"\">1st year</li>";
                        currentYear=csvRows[index][ACADEMIC_YEAR];}
                    else if(csvRows[index][ACADEMIC_YEAR]==2){
                        listOfYears += "<li id=\""+courseCode+csvRows[index][ACADEMIC_YEAR]+"\">2nd year</li>";
                        currentYear=csvRows[index][ACADEMIC_YEAR];}
                    else if(csvRows[index][ACADEMIC_YEAR]==3){
                        listOfYears += "<li id=\""+courseCode+csvRows[index][ACADEMIC_YEAR]+"\">3rd year</li>";
                        currentYear=csvRows[index][ACADEMIC_YEAR];}
                    else{
                        listOfYears += "<li id=\""+courseCode+csvRows[index][ACADEMIC_YEAR]+"\">"+csvRows[index][ACADEMIC_YEAR]+"th year</li>";
                        currentYear=csvRows[index][ACADEMIC_YEAR];}
                }
                index++;
            }
            listOfYears += "</ul><div id=\"modulesOfTheYear\"></div>"

            var options = document.getElementById("options");
            options.innerHTML = listOfYears;
            makeYearsClickable();
        }
        
        var showModulesOfYear = function(listElement){
            var listOfModules = "<ul id=\"modules\">";
            var courseCode = listElement.getAttribute('id').substring(0,2);
            var yearOfCourse = listElement.getAttribute('id').substring(2,3);
            var index = getCourseIndex(csvRows,courseCode);
            console.log("The first of that module is: "+csvRows[index][MODULE_NAME]+"Year of coures is: "+yearOfCourse);
            if(csvRows[index][ACADEMIC_YEAR]==yearOfCourse){ listOfModules += "<li id=\""+csvRows[index][MODULE_ID]+"\">"+csvRows[index][MODULE_NAME]+"</li>"; }
            var lastModuleAdded = csvRows[index][MODULE_ID];
            index++;
            while(csvRows[index][MODULE_ID].indexOf(courseCode)==0){
                if(csvRows[index][MODULE_ID]!=lastModuleAdded && csvRows[index][ACADEMIC_YEAR]==yearOfCourse){
                    listOfModules += "<li id=\""+csvRows[index][MODULE_ID]+"\">"+csvRows[index][MODULE_NAME]+"</li>"
                    lastModuleAdded = csvRows[index][MODULE_ID];
                }
                index++;
            }
            listOfModules += "</ul>"

            var modulesOfTheYear = document.getElementById("modulesOfTheYear");
            modulesOfTheYear.innerHTML = listOfModules;
        }
        
        
        //Binary search data for a course.
        var getCourseIndex = function(data,courseCode){
            
            var low = 0;
            var high = data.length-1;
            var centre;
            var courseCodeAtCentre;
            
            while(low<=high){
                centre = Math.round((low+high)/2);
                courseCodeAtCentre = data[centre][0].substring(0,2);
                if(courseCodeAtCentre==courseCode){
                    while(centre!=0 && data[centre-1][0].substring(0,2)==courseCode){
                        centre--;
                    }
                    return centre;
                }
                else if(courseCodeAtCentre < courseCode){
                    low = centre+1;
                }
                if(courseCodeAtCentre > courseCode){
                    high = centre-1;
                }
            }
            console.log("No link was found for the courseCode: "+courseCode);
            return -1;
        };
        
    </script>
</body>
