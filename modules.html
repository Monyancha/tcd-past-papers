<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>Examinating - Courses</title>
    <script src="https://raw.githubusercontent.com/mholt/PapaParse/master/papaparse.js"></script>
</head>
<body>
    <div>
        <ul class="site-page-links">
            <li><a  href="index.html" id="MyModules">My Modules</a></li>
            <li><a  href="modules.html" id="All Modules">All Modules</a></li>
            <li><a  href="about.html" id="About">About</a></li>
        </ul>
    </div>
    <div id="options">
        Waiting for Files to be read.
    </div>
    <script>
        
        var MODULE_ID = 0;
        var YEAR_OF_COURSE = 1;
        var MODULE_NAME = 2;
        var LINK = 3;
        var ACADEMIC_YEAR = 4;
        var LAST_ACTIVE_MODULE = 1;
        var MODULES = 2;
        var YEARS = 2016-1998;
        
        window.addEventListener('load',function(){ startUp();},false);
        
        var csvRows;
        
        //Code run once the page is loaded.
        var startUp = function(){
            parseData("https://raw.githubusercontent.com/nating/examinating/master/PastPapers.csv", updateData);
            showAllCourses();
        }
        parseData = function(url, callBack) {
            Papa.parse(url,{download: true, dynamicTyping: true, complete: function(results){ callBack(results.data);} });
        }
        updateData = function(parsedFile) {
            csvRows = parsedFile;
        }
        
        var showAllCourses = function(){
            var options = document.getElementById("options");
            options.innerHTML = `
                <ul class="courses">
                    <li id="AN">AN Anatomy</li>
                    <li id="AP">AP Foundation Course for Higher Education</li>
                    <li id="BI">BI Biochemistry &amp; Immunology</li>
                    <li id="BO">BO Botany</li>
                    <li id="BU">BU Business Studies</li>
                    <li id="BY">BY Biology</li>
                    <li id="CE">CE Civil Structural &amp; Enviromental Engineering</li>
                    <li id="CH">CH Chemistry</li>
                    <li id="CL">CL Classics</li>
                    <li id="CS">CS Computer Science</li>
                    <li id="DE">DE Dental Studies</li>
                    <li id="DF">DF Deaf Studies</li>
                    <li id="DR">DR Drama</li>
                    <li id="EC">EC Economics</a></li>
                    <li id="EE">EE Electrical &amp; Electronic Engineering</li>
                    <li id="EN">EN English</li>
                    <li id="ES">ES Enviromental Science</li>
                    <li id="ET">ET Music Education</li>
                    <li id="FB">FB Functional Biology</li>
                    <li id="FR">FR French</li>
                    <li id="GE">GE Genetics &amp; Microbiology</li>
                    <li id="GG">GG Geography</li>
                    <li id="GL">GL Geology</li>
                    <li id="GR">GR German</li>
                    <li id="HA">HA History of Art</li>
                    <li id="HE">HE Religions &amp; Theology</li>
                    <li id="HH">HH Histories &amp; Humanitaries</li>
                    <li id="HI">HI History</li>
                    <li id="IE">IE Imagining Ireland</li>
                    <li id="IR">IR Irish Studies</li>
                    <li id="IT">IT Italian</li>
                    <li id="LA">LA Law</li>
                    <li id="LI">LI Linguistics</li>
                    <li id="LY">LY Loyola Institute</li>
                    <li id="MA">MA Mathematics</li>
                    <li id="MD">MD Medicine</li>
                    <li id="ME">ME Mechanical &amp; Manufactural Engineering</li>
                    <li id="MI">MI Microbiology</li>
                    <li id="MU">MU Music</li>
                    <li id="MW">MW Midwifery</a></li>
                    <li id="NM">NM Near &amp; Middle Eastern Studies</li>
                    <li id="NU">NU Nursing</a></li>
                    <li id="OT">OT Occupational Therapy</li>
                    <li id="PG">PG Physiology</li>
                    <li id="PH">PH Pharmacy</li>
                    <li id="PI">PI Phisiology</li>
                    <li id="PL">PL Polish</li>
                    <li id="PO">PO Political Science</li>
                    <li id="PR">PR Psychiatry</li>
                    <li id="PS">PS Psychology</li>
                    <li id="PT">PT Physiotherapy</li>
                    <li id="PY">PY Physics</li>
                    <li id="RT">RT Radiotherapy</li>
                    <li id="RU">RU Russian &amp; Slavonic Studies</li>
                    <li id="SL">SL Clinical Speech &amp; Language Studies</li>
                    <li id="SO">SO Sociology</li>
                    <li id="SP">SP Hispanic Studies</li>
                    <li id="SS">SS Social Work &amp; Social Policy</li>
                    <li id="ST">ST Statistics</li>
                    <li id="ZO">ZO Zoology</li>
                </ul>`;
            makeCoursesClickable();
        }
        
        var makeCoursesClickable = function() {
            var links = document.getElementsByTagName('li');
            for(var i=0;i<links.length;i++) {
                var link = links[i];
                if(link.parentElement.getAttribute('class') == 'courses') {
                    link.setAttribute("onclick","showYearsOfCourse("+link.getAttribute('id')+");");
                }
            }
        }
        
        var makeYearsClickable = function() {
            var links = document.getElementsByTagName('li');
            for(var i=0;i<links.length;i++) {
                var link = links[i];
                if(link.parentElement.getAttribute('class') == 'years') {
                    console.log(link);
                    link.setAttribute("onclick","showModulesOfYear("+link.getAttribute('id')+");");
                }
            }
        }
        
        var showYearsOfCourse = function(listElement){
            var listOfYears = "<a href=\"modules.html\"><-- All Courses</a><ul class=\"years\">";
            var courseCode = listElement.getAttribute('id');
            var index = getCourseIndex(csvRows,courseCode);
            var currentYear = 0;
            while(csvRows[index][MODULE_ID].indexOf(courseCode)==0){
                if(csvRows[index][ACADEMIC_YEAR] > currentYear){
                    if(csvRows[index][ACADEMIC_YEAR]==1){
                        listOfYears += "<li id=\""+courseCode+csvRows[index][ACADEMIC_YEAR]+"\">1st year</li>";
                        currentYear=csvRows[index][ACADEMIC_YEAR];}
                    else if(csvRows[index][ACADEMIC_YEAR]==2){
                        listOfYears += "<li id=\""+courseCode+csvRows[index][ACADEMIC_YEAR]+"\">2nd year</li>";
                        currentYear=csvRows[index][ACADEMIC_YEAR];}
                    else if(csvRows[index][ACADEMIC_YEAR]==3){
                        listOfYears += "<li id=\""+courseCode+csvRows[index][ACADEMIC_YEAR]+"\">3rd year</li>";
                        currentYear=csvRows[index][ACADEMIC_YEAR];}
                    else{
                        listOfYears += "<li id=\""+courseCode+csvRows[index][ACADEMIC_YEAR]+"\">"+csvRows[index][ACADEMIC_YEAR]+"th year</li>";
                        currentYear=csvRows[index][ACADEMIC_YEAR];}
                }
                index++;
            }
            listOfYears += "</ul><div id=\"modulesOfTheYear\"></div>"

            var options = document.getElementById("options");
            options.innerHTML = listOfYears;
            makeYearsClickable();
        }
        
        var showModulesOfYear = function(listElement){
            var listOfModules = "<ul id=\"modules\">";
            var courseCode = listElement.getAttribute('id').substring(0,2);
            var yearOfCourse = listElement.getAttribute('id').substring(2,3);
            var index = getCourseIndex(csvRows,courseCode);
            console.log("The first of that module is: "+csvRows[index][MODULE_NAME]+"Year of course is: "+yearOfCourse);
            if(csvRows[index][ACADEMIC_YEAR]==yearOfCourse){ listOfModules += "<li id=\""+csvRows[index][MODULE_ID]+"\">"+csvRows[index][MODULE_NAME]+"</li>"; }
            var lastModuleAdded = csvRows[index][MODULE_ID];
            index++;
            while(csvRows[index][MODULE_ID].indexOf(courseCode)==0){
                if(csvRows[index][MODULE_ID]!=lastModuleAdded && csvRows[index][ACADEMIC_YEAR]==yearOfCourse){
                    listOfModules += "<li id=\""+csvRows[index][MODULE_ID]+"\">"+csvRows[index][MODULE_NAME]+"</li>"
                    lastModuleAdded = csvRows[index][MODULE_ID];
                }
                index++;
            }
            listOfModules += "</ul>"

            var modulesOfTheYear = document.getElementById("modulesOfTheYear");
            modulesOfTheYear.innerHTML = listOfModules;
        }
        
        
        //Binary search data for a course.
        var getCourseIndex = function(data,courseCode){
            
            var low = 0;
            var high = data.length-1;
            var centre;
            var courseCodeAtCentre;
            
            while(low<=high){
                centre = Math.round((low+high)/2);
                courseCodeAtCentre = data[centre][0].substring(0,2);
                if(courseCodeAtCentre==courseCode){
                    while(centre!=0 && data[centre-1][0].substring(0,2)==courseCode){
                        centre--;
                    }
                    return centre;
                }
                else if(courseCodeAtCentre < courseCode){
                    low = centre+1;
                }
                if(courseCodeAtCentre > courseCode){
                    high = centre-1;
                }
            }
            console.log("No link was found for the courseCode: "+courseCode);
            return -1;
        };
        
    </script>
</body>
